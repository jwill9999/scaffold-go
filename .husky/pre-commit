#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ§ª Running tests..."
npm run test || {
  echo "âŒ Tests failed. Please fix them before committing."
  exit 1
}

echo "ğŸ” Running linters..."
npm run lint:fix || {
  echo "âŒ Linting failed. Please fix the issues before committing."
  exit 1
}

echo "ğŸ”’ Running security checks..."
npm run security || {
  echo "âŒ Security checks failed. Please fix the vulnerabilities before committing."
  exit 1
}

echo "âœ¨ Formatting code..."
npm run format || {
  echo "âŒ Formatting failed. Please check goimports installation."
  exit 1
}

# Stage any formatting changes made by goimports
STAGED_GO_FILES=$(git diff --name-only --cached -- '*.go')
if [ -n "$STAGED_GO_FILES" ]; then
  git add $STAGED_GO_FILES
fi

echo "âœ… Pre-commit checks passed!" 